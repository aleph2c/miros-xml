







<!DOCTYPE html>
<html  lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>&lt;no title&gt; | miros-xml</title>
    <link rel="shortcut icon" href="_static/favicon.ico">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css">
    <link rel="stylesheet" href="_static/theme.css" type="text/css">
    
    

    
    <script type="text/javascript" src="_static/theme.js" defer></script>
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    
    <script src="_static/jquery.js"></script>
    
    <script src="_static/underscore.js"></script>
    
    <script src="_static/doctools.js"></script>
    
    

    
      
      
    <link rel="index" title="Index" href="genindex.html">
      
      
    <link rel="search" title="Search" href="search.html">
      
      
      
      
    

    

    

    
  </head>

  <body>
    <header class="main-header">
      <div class="navbar">
        <div id="js-sidebar-mask" class="sidebar-mask"></div>
        <div id="js-sidebar-menu-button" class="sidebar-menu-button">
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg>
        </div>
        <a href="index.html" class="site-link">
          
          miros-xml
          
        </a>
        <div class="navbar-links">
          <a href="installation.html" class="navbar-link">Docs</a>
          
          <a href="https://github.com/aleph2c/miros-xml" class="navbar-link">GitHub</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg>
          
        </div>
      </div>
    </header>

    <main class="main-wrapper">
      
      <div id="js-main-sidebar" class="main-sidebar">
        
        <div class="sidebar-content sidebar-content--divider sidebar-navbar-links">
          <a href="https://github.com/aleph2c/miros-xml" class="sidebar-navbar-link">GitHub</a>
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg>
        </div>
        
        
        <h3 class="sidebar-heading">About</h3>
<ul>
  <li>XML for <a "https://github.com/aleph2c/miros">miros</a> 
</ul>
        
        

<h2 class="sidebar-heading">Contents</h2>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Getting Your Head in the Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="techniques.html">Techniques</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_it_works.html">How it Works</a></li>
</ul>

        
        <h3 class="sidebar-heading">Useful Links</h3>
  <ul>
    <li><a href="https://aleph2c.github.io/miros-rabbitmq/html/index.html">miros on github</a></li>
    <li><a href="https://github.com/aleph2c/sequence">sequence on
        github</a></li>
    <li><a
          href="https://aleph2c.github.io/miros-rabbitmq/html/index.html">miros-rabbitmq
          plugin</a></li>
    <li><a href="http://www.umlet.com">UMLet Download</a></li>
    <li><a
          href="http://www.inf.ed.ac.uk/teaching/courses/seoc/2005_2006/resources/statecharts.pdf">formalism
          explained</a></li>
  </ul>
<h3 class="sidebar-heading">Statechart Videos</h3>
  <ul>
    <li><a href="https://www.mathworks.com/videos/understanding-state-machines-what-are-they-1-of-4-90488.html">Part 1 (What)</a></li> 
    <li><a
          href="https://www.mathworks.com/videos/understanding-state-machines-why-use-them-2-of-4-90489.html">Part 2 (Why)</a></li>
    <li><a
          href="https://www.mathworks.com/videos/understanding-state-machines-what-are-they-1-of-4-90488.html">Part 3 (Mealy/Moore)</a></li>
    <li><a
          href="https://www.mathworks.com/videos/understanding-state-machines-harel-state-machines-4-of-4-90491.html">Part 4 (Harel Statecharts)</a></li>
    <li><a href="https://barrgroup.com/Embedded-Systems/How-To/Introduction-Hierarchical-State-Machines">Introduction to HSMs</a></li>
</ul>
        
        

<div id="searchbox" style="display: none" role="search">
  <h2 id="searchlabel" class="sidebar-heading">Quick search</h2>
  <div class="searchformwrapper sidebar-content">
    <form class="search" action="search.html" method="get">
      <input class="sidebar-search sidebar-search--input" type="text" name="q" aria-labelledby="searchlabel"><input class="sidebar-search sidebar-search--btn" type="submit" value="Go">
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>

        
      </div>
      

      
      <div class="main-content main-content--sidebar">
      
        
          
  <p>The miros-xml package <a class="reference internal" href="how_it_works.html#how-it-works-hidden-states-and-what-they-are-for"><span class="std std-ref">adds four hidden functions</span></a> (grey in the diagram) for
each orthogonal state:</p>
<a class="reference external image-reference" href="_static/hidden_states_1.pdf"><img alt="_images/hidden_states_1.svg" class="noscale-center" src="_images/hidden_states_1.svg" /></a>
<p><strong>Goal</strong>: We want the <code class="docutils literal notranslate"><span class="pre">add</span></code> method of the <code class="docutils literal notranslate"><span class="pre">Regions</span></code> object to create the grayed
out functions for us, using a predetermined naming convention.</p>
<p>We will use the module_namespace to attach and get functions based on a string,
using the Python <code class="docutils literal notranslate"><span class="pre">setattr/getattr</span></code> builtins.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">module_namespace</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">]</span>

<span class="c1"># these are the same</span>
<span class="n">module_namespace</span><span class="o">.</span><span class="n">p_r1_under_hidden_region</span><span class="p">()</span>
<span class="nb">getattr</span><span class="p">(</span><span class="n">module_namespace</span><span class="p">,</span> <span class="s1">&#39;p_r1_under_hidden_region&#39;</span><span class="p">)()</span>
</pre></div>
</div>
<p>Before we make something that writes functions, we will type one out by hand,
pass a full regression test, then identify the parts of the function we want to
change:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@othogonal_state</span>
<span class="hll"><span class="k">def</span> <span class="nf">p_r1_under_hidden_region</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
</span>  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="n">__super__</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">bottom</span>

  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">SEARCH_FOR_SUPER_SIGNAL</span><span class="p">):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">__super__</span>
    <span class="k">return</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>

  <span class="k">if</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">token_match</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal_name</span><span class="p">,</span> <span class="s2">&quot;enter_region&quot;</span><span class="p">)):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">_p_spy</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="hll">    <span class="n">status</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">p_r1_region</span><span class="p">)</span>
</span>  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">_p_spy</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">_p_spy</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">r</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">__super__</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</td></tr></table></div>
<p>Things that need to change in the above function:</p>
<ul class="simple">
<li><p>it needs a unique name (line 1)</p></li>
<li><p>it will reference the <code class="docutils literal notranslate"><span class="pre">p_r1_region</span></code> function, line 12.</p></li>
</ul>
<p>Now we write a template, knowing that we will rename it later.  We use the
<code class="docutils literal notranslate"><span class="pre">*</span></code>, character to separate the non-mandatorily-named arguments from the ones
that require a name; <code class="docutils literal notranslate"><span class="pre">region_state_name</span></code>.  We also add the <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> as a
place holder for named arguments this function will not use.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">template_under_hidden_region</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">region_state_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;some docstring&#39;&#39;&#39;</span>

  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="n">__super__</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">bottom</span>

<span class="hll">  <span class="n">region_state_function</span> <span class="o">=</span> \
</span><span class="hll">    <span class="nb">getattr</span><span class="p">(</span><span class="n">module_namespace</span><span class="p">,</span> <span class="n">region_state_name</span><span class="p">)</span>
</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">SEARCH_FOR_SUPER_SIGNAL</span><span class="p">):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">__super__</span>
    <span class="k">return</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>

  <span class="k">if</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">token_match</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal_name</span><span class="p">,</span> <span class="s2">&quot;enter_region&quot;</span><span class="p">)):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">_p_spy</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="hll">    <span class="n">status</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">region_state_function</span><span class="p">)</span>
</span>  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">_p_spy</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">_p_spy</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">_p_spy</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">r</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">__super__</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</td></tr></table></div>
<p>Notice on lines 7-8, we use <code class="docutils literal notranslate"><span class="pre">getattr(module_namespace,</span> <span class="pre">region_state_name)</span></code> to
get the region function.  This function is used on line 16.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">region_state_name</span></code> was set to <code class="docutils literal notranslate"><span class="pre">p_r1_region</span></code>, our function would behave
the same as the one we wrote out by hand.  Notice, that the template does not
have an <code class="docutils literal notranslate"><span class="pre">orthogonal</span></code> decorator, but our handwritten function does. This
decorator will be added later.</p>
<p>Now we want to create a new function based on some naming conventions:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">update_wrapper</span>

<span class="c1"># functions at the top of the file</span>
<span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">under_hidden_region_function_name</span><span class="p">(</span><span class="n">region_name</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">region_name</span> <span class="o">+</span> <span class="s2">&quot;_under_hidden_region&quot;</span>

<span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">region_function_name</span><span class="p">(</span><span class="n">region_name</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">region_name</span> <span class="o">+</span> <span class="s2">&quot;_region&quot;</span>

<span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">over_hidden_region_function_name</span><span class="p">(</span><span class="n">region_name</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">region_name</span> <span class="o">+</span> <span class="s2">&quot;_over_hidden_region&quot;</span>

<span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">final_region_function_name</span><span class="p">(</span><span class="n">region_name</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">region_name</span> <span class="o">+</span> <span class="s2">&quot;_final&quot;</span>

<span class="c1"># ..</span>

<span class="c1"># in the Regions class:</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region_name</span><span class="p">,</span> <span class="n">initial_state</span><span class="p">,</span> <span class="n">outer</span><span class="p">):</span>
  <span class="c1"># ...</span>
  <span class="n">region_name</span> <span class="o">=</span> <span class="s2">&quot;p_r1&quot;</span>  <span class="c1"># force the region_name for our example</span>
  <span class="n">under_s</span> <span class="o">=</span> <span class="n">under_hidden_region_function_name</span><span class="p">(</span><span class="n">region_name</span><span class="p">)</span>
  <span class="n">region_s</span> <span class="o">=</span> <span class="n">region_function_name</span><span class="p">(</span><span class="n">region_name</span><span class="p">)</span>
  <span class="n">over_s</span> <span class="o">=</span> <span class="n">over_hidden_region_function_name</span><span class="p">(</span><span class="n">region_name</span><span class="p">)</span>
  <span class="n">final_s</span> <span class="o">=</span> <span class="n">final_region_function_name</span><span class="p">(</span><span class="n">region_name</span><span class="p">)</span>

  <span class="c1"># The &#39;template_under_hidden_region&#39; is defined in documentation above,</span>
  <span class="c1"># the other templates would be defined in similar manner</span>
<span class="hll">  <span class="k">for</span> <span class="n">function_name</span><span class="p">,</span> <span class="n">template</span> <span class="ow">in</span> <span class="p">[</span>
</span><span class="hll">    <span class="p">(</span><span class="n">under_s</span><span class="p">,</span> <span class="n">template_under_hidden_region</span><span class="p">),</span>
</span><span class="hll">    <span class="p">(</span><span class="n">region_s</span><span class="p">,</span> <span class="n">template_region</span><span class="p">),</span>
</span><span class="hll">    <span class="p">(</span><span class="n">over_s</span><span class="p">,</span> <span class="n">template_over_hidden_region</span><span class="p">),</span>
</span><span class="hll">    <span class="p">(</span><span class="n">final_s</span><span class="p">,</span> <span class="n">template_final</span><span class="p">)</span>
</span><span class="hll">  <span class="p">]:</span>
</span>
    <span class="c1"># The &#39;template&#39; and &#39;region_state_name&#39; are used in the</span>
    <span class="c1"># &#39;template_under_hidden_region&#39;, but the other named arguments are</span>
    <span class="c1"># placed into its kwargs argument and ignored by the function.  These</span>
    <span class="c1"># extra named arguments are needed by one or more of the other template</span>
    <span class="c1"># functions.</span>
<span class="hll">    <span class="n">fn</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
</span><span class="hll">      <span class="n">template</span><span class="p">,</span>
</span><span class="hll">      <span class="n">this_function_name</span><span class="o">=</span><span class="n">function_name</span><span class="p">,</span>
</span><span class="hll">      <span class="n">under_region_state_name</span><span class="o">=</span><span class="n">under_s</span><span class="p">,</span>
</span><span class="hll">      <span class="n">region_state_name</span><span class="o">=</span><span class="n">region_s</span><span class="p">,</span>
</span><span class="hll">      <span class="n">over_region_state_name</span><span class="o">=</span><span class="n">over_s</span><span class="p">,</span>
</span><span class="hll">      <span class="n">final_state_name</span><span class="o">=</span><span class="n">final_s</span><span class="p">,</span>
</span><span class="hll">      <span class="n">initial_state_name</span><span class="o">=</span><span class="n">initial_state</span>
</span><span class="hll">    <span class="p">)</span>
</span>
<span class="hll">    <span class="c1"># give the fn the meta data defined by its template</span>
</span><span class="hll">    <span class="n">fn</span> <span class="o">=</span> <span class="n">update_wrapper</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
</span><span class="hll">    <span class="c1"># over-write the function name</span>
</span><span class="hll">    <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">function_name</span>
</span><span class="hll">    <span class="c1"># wrap the function with an instrumentation decorator</span>
</span><span class="hll">    <span class="n">fn</span> <span class="o">=</span> <span class="n">orthogonal_state</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span class="hll">    <span class="c1"># over-write the instrumented function with its name</span>
</span><span class="hll">    <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">function_name</span>
</span><span class="hll">    <span class="c1"># place the new function in this module&#39;s namespace</span>
</span><span class="hll">    <span class="nb">setattr</span><span class="p">(</span><span class="n">module_namespace</span><span class="p">,</span> <span class="n">function_name</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
</span>
  <span class="c1"># Here we get the functions from the name space using our function names as</span>
  <span class="c1"># strings.</span>
<span class="hll">  <span class="n">region_state_function</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module_namespace</span><span class="p">,</span> <span class="n">region_s</span><span class="p">)</span>
</span><span class="hll">  <span class="n">over_hidden_state_function</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module_namespace</span><span class="p">,</span> <span class="n">over_s</span><span class="p">)</span>
</span><span class="hll">  <span class="n">under_hidden_state_function</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module_namespace</span><span class="p">,</span> <span class="n">under_s</span><span class="p">)</span>
</span>
  <span class="k">assert</span><span class="p">(</span><span class="n">callable</span><span class="p">(</span><span class="n">p_r1_under_hidden_region</span><span class="p">))</span>    <span class="c1"># can call what was created</span>
  <span class="k">assert</span><span class="p">(</span><span class="n">callable</span><span class="p">(</span><span class="n">under_hidden_state_function</span><span class="p">))</span> <span class="c1"># can call indirectly too</span>
  <span class="k">assert</span><span class="p">(</span><span class="n">callable</span><span class="p">(</span><span class="n">region_function_name</span><span class="p">))</span>
  <span class="k">assert</span><span class="p">(</span><span class="n">callable</span><span class="p">(</span><span class="n">over_hidden_state_function</span><span class="p">))</span>

  <span class="c1"># ... construct the regions</span>
</pre></div>
</td></tr></table></div>
<p>The above code listing shows how all of our hidden functions would be made from
a set of templates, an initial_state target and some function names built by a
convention using the region name.</p>
<p>Lines 35-40 show how we specify a template-naming partnership.</p>
<p>Lines 47-55 shows how a new function is built from the template.</p>
<p>Lines 57-66 name our new function, wrap it with an instrumentation decorator,
name this wrapped function, then attach it to the modules namespace.</p>
<p>Lines 70-72 show how to get a function using its name.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you have done work like this, never use the eval(function_name_as_string)
to get access to the function.  This will destroy the function’s <code class="docutils literal notranslate"><span class="pre">__name__</span></code> and
<code class="docutils literal notranslate"><span class="pre">__doc__</span></code> values and cause your tests to fail.</p>
</div>


        
        <div class="main-content__right-sidebar">
          <h2 class="sidebar-heading">On this page:</h2>
        </div>
      </div>
    </main>

    <div class="footer-wrapper">
      
      <footer class="main-footer main-footer--sidebar">
      
        <div class="relational-links">
          <div>
            
          </div>
          <div>
            
          </div>
        </div>
        
        <div class="copyright">
          © Copyright <span class="js-year"></span>,
          
          <a href="https://github.com/aleph2c" class="copyright_link">Scott Volk</a>.
          
        </div>
        
        
        <div class="last-updated">
          <span class="prefix">Last updated:</span>
          <span class="time">Jan 30, 2021 6:26 PM</span>
        </div>
        
        
        <div class="created-with">
          Created using <a href="http://sphinx-doc.org/" class="copyright_link">Sphinx</a> 3.4.0 with <span class="theme">13ds_theme_one</span>.
        </div>
        
      </footer>
    </div>
  </body>
</html>